<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>DAY – Message & Tree</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: dark;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d2539 0%, #020617 55%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .card {
      max-width: 760px;
      width: 100%;
      background: rgba(15,23,42,0.95);
      border-radius: 18px;
      padding: 22px 18px 26px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,184,0.35);
    }
    h1 {
      margin: 0 0 8px;
      font-size: 1.6rem;
    }
    p.caption {
      margin: 0 0 14px;
      font-size: 0.9rem;
      color: #9ca3af;
    }
    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }
    textarea, input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 9px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.95rem;
      outline: none;
    }
    textarea { min-height: 90px; resize: vertical; }
    input[type="color"] { padding: 0; height: 40px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .row > div { flex: 1 1 150px; }
    button.primary {
      margin-top: 18px;
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #02140a;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }
    button.primary:hover { background: #4ade80; }
    .result {
      margin-top: 22px;
      padding-top: 16px;
      border-top: 1px dashed #374151;
      display: none;
    }
    .summary {
      font-size: 0.9rem;
      color: #d1d5db;
      white-space: pre-line;
      margin-bottom: 10px;
    }
    .link-box {
      background: #020617;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.84rem;
      word-wrap: break-word;
      border: 1px solid #1f2937;
      margin-bottom: 12px;
    }
    .link-box a {
      color: #38bdf8;
      text-decoration: none;
    }
    .qr-wrapper {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    #qrcode {
      background: #f9fafb;
      padding: 8px;
      border-radius: 12px;
    }
    .note { font-size: 0.8rem; color: #9ca3af; }

    /* viewer mode */
    .viewer-layout {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
    }
    .tree-box {
      flex: 0 0 200px;
      background: #020617;
      border-radius: 14px;
      padding: 10px 8px;
      border: 1px solid #1f2937;
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 0.78rem;
      line-height: 1.1;
      text-align: center;
    }
    .tree-title {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    #tree {
      white-space: pre;
    }
    .message-box {
      flex: 1 1 260px;
      background: #020617;
      border-radius: 14px;
      padding: 12px 12px 14px;
      border: 1px solid #1f2937;
    }
    .to {
      font-size: 0.95rem;
      margin-bottom: 4px;
    }
    .msg {
      font-size: 1.08rem;
      line-height: 1.6;
      min-height: 80px;
      white-space: pre-wrap;
    }
    .meta {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #9ca3af;
    }
    .footer {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 0.84rem;
    }
    .footer a {
      color: #38bdf8;
      text-decoration: none;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid #38bdf8;
    }

    #generatorCard { display: none; }
    #viewerCard { display: none; }
  </style>
</head>
<body>
  <div class="card" id="generatorCard">
    <h1>สร้างลิงก์ข้อความ + QR (เวอร์ชัน DAY)</h1>
    <p class="caption">
      ใส่ข้อความ, ความเร็ว, สี และ “ส่งถึงใคร” เดี๋ยวระบบสรุปให้
      พร้อมสร้างลิงก์สั้น (แบบ query สั้น ๆ) และ QR ใช้งานบน GitHub Pages ได้เลย
    </p>

    <!-- INPUTS -->
    <label for="msg">1. ข้อความที่จะให้พิมพ์</label>
    <textarea id="msg" placeholder="เช่น ขอบคุณที่อยู่ข้าง ๆ กันนะ :)"></textarea>

    <div class="row">
      <div>
        <label for="speed">2. ความเร็วในการพิมพ์ (มิลลิวินาที / ตัวอักษร)</label>
        <input id="speed" type="number" min="10" max="500" value="60" />
      </div>
      <div>
        <label for="color">3. สีของตัวข้อความ</label>
        <input id="color" type="color" value="#00ff7f" />
      </div>
    </div>

    <label for="to">4. ส่งถึงใคร</label>
    <input id="to" type="text" placeholder="เช่น ส่งถึง: เดย์" />

    <button class="primary" id="generateBtn">สรุป & สร้างลิงก์ + QR</button>

    <!-- OUTPUT -->
    <div class="result" id="result">
      <div class="summary" id="summary"></div>

      <div class="link-box">
        <strong>ลิงก์สั้นที่สร้างได้:</strong><br />
        <a id="shortLink" href="#" target="_blank"></a>
      </div>

      <div class="qr-wrapper">
        <div id="qrcode"></div>
        <div class="note">
          สแกน QR นี้ จะเปิดไปยังหน้าแสดงข้อความ (พร้อมต้นคริสต์มาสกระพริบ)
          บนเว็บไซต์ของเดย์
        </div>
      </div>
    </div>
  </div>

  <!-- VIEWER MODE -->
  <div class="card" id="viewerCard">
    <h1>ข้อความพิเศษจากเดย์</h1>
    <p class="caption">
      ข้อความนี้ถูกสร้างผ่านหน้าเครื่องมือข้อความของเดย์
      แสดงแบบพิมพ์ทีละตัว พร้อมต้นคริสต์มาสประดับไฟ
    </p>

    <div class="viewer-layout">
      <div class="tree-box">
        <div class="tree-title">DAY XMAS TREE</div>
        <div id="tree"></div>
      </div>
      <div class="message-box">
        <div class="to" id="toLine"></div>
        <div class="msg" id="msgBox"></div>
        <div class="meta" id="meta"></div>
        <div class="footer">
          <span id="status">กำลังพิมพ์ข้อความ...</span>
          <a id="homeLink" href="#" target="_blank">กลับไปเว็บไซต์หลักของเดย์</a>
        </div>
      </div>
    </div>
  </div>

  <!-- QRCode.js CDN (ใช้ตอนโหมดสร้างลิงก์) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    // ======= CONFIG =======
    // ลิงก์เว็บไซต์หลักของเดย์ (เดย์ให้มาแล้ว):
    const HOME_URL = "https://buisme.github.io/day-project-hub/";

    // ลิงก์ของไฟล์นี้เอง ใช้สำหรับสร้างลิงก์สั้นอัตโนมัติ
    const MESSAGE_PAGE_URL = window.location.origin + window.location.pathname;

    // ======= MODE DETECT =======
    const params = new URLSearchParams(window.location.search);
    const hasMessage = params.has("m");

    const generatorCard = document.getElementById("generatorCard");
    const viewerCard    = document.getElementById("viewerCard");

    if (hasMessage) {
      // โหมดแสดงข้อความ
      viewerCard.style.display = "block";
      setupViewerMode();
    } else {
      // โหมดสร้างลิงก์
      generatorCard.style.display = "block";
      setupGeneratorMode();
    }

    // ======= GENERATOR MODE =======
    function setupGeneratorMode() {
      const msgEl   = document.getElementById("msg");
      const speedEl = document.getElementById("speed");
      const colorEl = document.getElementById("color");
      const toEl    = document.getElementById("to");

      const resultBox = document.getElementById("result");
      const summaryEl = document.getElementById("summary");
      const linkEl    = document.getElementById("shortLink");
      const qrBox     = document.getElementById("qrcode");

      document.getElementById("generateBtn").addEventListener("click", () => {
        const msg   = msgEl.value.trim();
        const speed = parseInt(speedEl.value, 10) || 60;
        const color = colorEl.value || "#00ff7f";
        const to    = toEl.value.trim() || "ใครบางคน";

        if (!msg) {
          alert("กรุณาพิมพ์ข้อความก่อนนะ");
          msgEl.focus();
          return;
        }

        // ใช้ key สั้น ๆ เพื่อให้ query สั้นที่สุด
        const p = new URLSearchParams({
          m: msg,
          s: String(speed),
          c: color.replace("#",""), // ตัด # ออก
          t: to
        });

        const shortUrl = MESSAGE_PAGE_URL + "?" + p.toString();

        // สรุปค่าอินพุต
        summaryEl.textContent =
          "สรุปค่าที่รับมา:\n" +
          `• ข้อความ: ${msg}\n` +
          `• ความเร็วพิมพ์: ${speed} ms/ตัวอักษร\n` +
          `• สีตัวอักษร: ${color}\n` +
          `• ส่งถึง: ${to}`;

        linkEl.textContent = shortUrl;
        linkEl.href = shortUrl;

        // สร้าง QR
        qrBox.innerHTML = "";
        new QRCode(qrBox, {
          text: shortUrl,
          width: 200,
          height: 200
        });

        resultBox.style.display = "block";
      });
    }

    // ======= VIEWER MODE (message + tree) =======
    function setupViewerMode() {
      const m = params.get("m") || "ยังไม่ได้ส่งข้อความมานะ :)";
      const s = parseInt(params.get("s") || "60", 10);
      const cHex = params.get("c") || "00ff7f";
      const t = params.get("t") || "ใครบางคน";

      const msgBox = document.getElementById("msgBox");
      const toLine = document.getElementById("toLine");
      const meta   = document.getElementById("meta");
      const status = document.getElementById("status");
      const homeLink = document.getElementById("homeLink");

      const color = "#" + cHex;

      toLine.textContent = "ส่งถึง: " + t;
      toLine.style.color = color;
      msgBox.style.color = color;

      meta.textContent =
        "ความเร็วในการพิมพ์: " + (isNaN(s) ? 60 : s) +
        " ms/ตัวอักษร • สีข้อความ: " + color;

      homeLink.href = HOME_URL;

      typeWriter(m, isNaN(s) ? 60 : s, msgBox, status);
      startTreeAnimation(color);
    }

    async function typeWriter(text, speed, msgBox, statusEl) {
      msgBox.textContent = "";
      for (let ch of text) {
        msgBox.textContent += ch;
        await new Promise(res => setTimeout(res, speed));
      }
      statusEl.textContent = "พิมพ์ข้อความเสร็จแล้ว";
    }

    // ======= ASCII TREE ANIMATION =======
    const treeLines = [
      "        *",
      "       ***",
      "      *****",
      "     *******",
      "    *********",
      "   ***********",
      "  *************",
      "       |||",
      "       |||"
    ];

    const treeColors = [
      "#f97316", // orange
      "#fb7185", // pink
      "#22c55e", // green
      "#38bdf8", // sky
      "#eab308"  // yellow
    ];

    function startTreeAnimation(mainColor) {
      const treeEl = document.getElementById("tree");
      const baseColor = mainColor || "#22c55e";

      function render() {
        let html = "";
        for (let i = 0; i < treeLines.length; i++) {
          const line = treeLines[i];
          for (let ch of line) {
            if (ch === "*") {
              const color = treeColors[Math.floor(Math.random() * treeColors.length)];
              html += `<span style="color:${color}">*</span>`;
            } else if (ch === "|") {
              html += `<span style="color:#9ca3af">|</span>`;
            } else if (ch === " ") {
              html += " ";
            } else {
              html += `<span style="color:${baseColor}">${ch}</span>`;
            }
          }
          html += "\n";
        }
        treeEl.innerHTML = html;
      }

      render();
      setInterval(render, 180); // กระพริบไฟ
    }
  </script>
</body>
</html>
