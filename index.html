<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>DAY ‚Äì Message & Symbols</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d2539 0%, #020617 55%, #000 100%);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 0.6s ease;
    }
    .card {
      max-width: 760px;
      width: 100%;
      background: rgba(15,23,42,0.95);
      border-radius: 18px;
      padding: 22px 18px 26px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.55);
      border: 1px solid rgba(148,163,184,0.35);
    }
    h1 { margin: 0 0 8px; font-size: 1.6rem; }
    p.caption { margin: 0 0 14px; font-size: 0.9rem; color: #9ca3af; }
    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-size: 0.9rem;
    }
    textarea, input, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 9px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.95rem;
      outline: none;
    }
    textarea { min-height: 90px; resize: vertical; }
    input[type="color"] { padding: 0; height: 40px; cursor: pointer; }
    input[type="date"] { cursor: pointer; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; }
    .row > div { flex: 1 1 150px; }
    button.primary {
      margin-top: 18px;
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #02140a;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    button.primary:hover { background: #4ade80; }
    .result {
      margin-top: 22px;
      padding-top: 16px;
      border-top: 1px dashed #374151;
      display: none;
    }
    .summary {
      font-size: 0.9rem;
      color: #d1d5db;
      white-space: pre-line;
      margin-bottom: 10px;
    }
    .link-box {
      background: #020617;
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.84rem;
      word-wrap: break-word;
      border: 1px solid #1f2937;
      margin-bottom: 12px;
    }
    .link-box a { color: #38bdf8; text-decoration: none; }
    .qr-wrapper {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    #qrcode {
      background: #f9fafb;
      padding: 8px;
      border-radius: 12px;
    }
    .note { font-size: 0.8rem; color: #9ca3af; }

    .gen-footer {
      margin-top: 18px;
      display: flex;
      justify-content: flex-end;
      font-size: 0.85rem;
    }
    .gen-footer a {
      color: #38bdf8;
      text-decoration: none;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid #38bdf8;
      transition: background 0.2s;
    }
    .gen-footer a:hover { background: rgba(56,189,248,0.1); }

    /* viewer mode */
    .viewer-layout {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
    }
    .symbol-box {
      flex: 0 0 200px;
      background: #020617;
      border-radius: 14px;
      padding: 10px 8px 12px;
      border: 1px solid #1f2937;
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 0.78rem;
      line-height: 1.1;
      text-align: center;
    }
    .symbol-title { display: none; }
    #symbolArea { white-space: pre-wrap; }
    .message-box {
      flex: 1 1 260px;
      background: #020617;
      border-radius: 14px;
      padding: 12px 12px 14px;
      border: 1px solid #1f2937;
      transition: box-shadow 0.25s, border-color 0.25s, background 0.25s;
    }
    .to { font-size: 0.95rem; margin-bottom: 4px; }
    .msg {
      font-size: 1.08rem;
      line-height: 1.6;
      min-height: 80px;
      white-space: pre-wrap;
    }
    .meta {
      margin-top: 8px;
      font-size: 0.78rem;
      color: #9ca3af;
      white-space: pre-line;
    }
    .footer {
      margin-top: 14px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 0.84rem;
    }
    .footer a {
      color: #38bdf8;
      text-decoration: none;
      padding: 5px 11px;
      border-radius: 999px;
      border: 1px solid #38bdf8;
      transition: background 0.2s;
    }
    .footer a:hover { background: rgba(56,189,248,0.1); }

    #generatorCard { display: none; }
    #viewerCard { display: none; }
  </style>
</head>
<body>
  <!-- ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå -->
  <div class="card" id="generatorCard">
    <h1>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° + QR (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô DAY)</h1>
    <p class="caption">
      ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°, ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß, ‡∏™‡∏µ, ‡∏Ñ‡∏ô‡∏£‡∏±‡∏ö, ‡∏õ‡πâ‡∏≤‡∏¢ "‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå",
      "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å" ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏µ‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÉ‡∏à
    </p>

    <label for="msg">1. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå</label>
    <textarea id="msg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á ‡πÜ ‡∏Å‡∏±‡∏ô‡∏ô‡∏∞ :)"></textarea>

    <div class="row">
      <div>
        <label for="speed">2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ / ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</label>
        <input id="speed" type="number" min="10" max="500" value="60" />
      </div>
      <div>
        <label for="color">3. ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
        <input id="color" type="color" value="#00ff7f" />
      </div>
    </div>

    <label for="to">4. ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡πÉ‡∏Ñ‡∏£</label>
    <input id="to" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: ‡πÄ‡∏î‡∏¢‡πå" />

    <label for="symbolKind">5. ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</label>
    <select id="symbolKind">
      <option value="xmas">‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™</option>
      <option value="newyear">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà (TH/EN)</option>
      <option value="songkran">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå</option>
      <option value="birthday">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</option>
    </select>

    <label for="fromLabel">6. ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å</label>
    <input id="fromLabel" type="text" placeholder='‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡∏¢‡πå, From Day, ‡∏Ø‡∏•‡∏Ø' />

    <label for="theme">7. ‡∏ò‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
    <select id="theme">
      <option value="default">‡∏õ‡∏Å‡∏ï‡∏¥</option>
      <option value="love">‡∏£‡∏±‡∏Å</option>
      <option value="sad">‡πÄ‡∏®‡∏£‡πâ‡∏≤</option>
      <option value="fun">‡∏™‡∏ô‡∏∏‡∏Å</option>
      <option value="thanks">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì</option>
    </select>

    <label for="startDate">8. ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î) ‚Äì ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</label>
    <input id="startDate" type="date" />

    <button class="primary" id="generateBtn">‡∏™‡∏£‡∏∏‡∏õ & ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå + QR</button>

    <div class="result" id="result">
      <div class="summary" id="summary"></div>

      <div class="link-box">
        <strong>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ:</strong><br />
        <a id="shortLink" href="#" target="_blank"></a>
      </div>

      <div class="qr-wrapper">
        <div id="qrcode"></div>
        <div class="note">
          ‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏û‡∏£‡πâ‡∏≠‡∏° "‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå"
          ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô + ‡∏ò‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¢‡πå
        </div>
      </div>
    </div>

    <div class="gen-footer">
      <a id="genHomeLink" href="#">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¢‡πå</a>
    </div>
  </div>

  <!-- ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
  <div class="card" id="viewerCard">
    <h1 id="viewerTitle">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¢‡πå</h1>
    <p class="caption" id="viewerCaption"></p>

    <div class="viewer-layout">
      <div class="symbol-box">
        <div class="symbol-title" id="symbolTitle">‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</div>
        <div id="symbolArea"></div>
      </div>
      <div class="message-box" id="messageBox">
        <div class="to" id="toLine"></div>
        <div class="msg" id="msgBox"></div>
        <div class="meta" id="meta"></div>
        <div class="footer">
          <span id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</span>
          <a id="homeLink" href="#">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¢‡πå</a>
        </div>
      </div>
    </div>
  </div>

  <!-- QRCode.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- LZString ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏µ‡∏ö/‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

  <script>
    const HOME_URL = "https://buisme.github.io/day-project-hub/";
    const MESSAGE_PAGE_URL = window.location.href.split('?')[0];

    const params = new URLSearchParams(window.location.search);
    const hasData = params.has("d") || params.has("m");

    const generatorCard = document.getElementById("generatorCard");
    const viewerCard    = document.getElementById("viewerCard");

    document.getElementById("genHomeLink").href = HOME_URL;

    if (hasData) {
      viewerCard.style.display = "block";
      setupViewerMode();
    } else {
      generatorCard.style.display = "block";
      setupGeneratorMode();
      applyThemeBackground("default");
    }

    function applyThemeBackground(theme) {
      const body = document.body;
      if (theme === "love") {
        body.style.background =
          "radial-gradient(circle at top, rgba(255,102,153,0.25), #150416 65%)";
      } else if (theme === "sad") {
        body.style.background =
          "radial-gradient(circle at top, rgba(80,150,255,0.25), #0a1220 65%)";
      } else if (theme === "fun") {
        body.style.background =
          "radial-gradient(circle at top, rgba(255,215,0,0.3), #1a1400 65%)";
      } else if (theme === "thanks") {
        body.style.background =
          "radial-gradient(circle at top, rgba(34,197,94,0.28), #03150e 65%)";
      } else {
        body.style.background =
          "radial-gradient(circle at top, #1d2539 0%, #020617 55%, #000 100%)";
      }
    }

    function setupGeneratorMode() {
      const msgEl       = document.getElementById("msg");
      const speedEl     = document.getElementById("speed");
      const colorEl     = document.getElementById("color");
      const toEl        = document.getElementById("to");
      const kindEl      = document.getElementById("symbolKind");
      const fromEl      = document.getElementById("fromLabel");
      const themeEl     = document.getElementById("theme");
      const startDateEl = document.getElementById("startDate");

      const resultBox = document.getElementById("result");
      const summaryEl = document.getElementById("summary");
      const linkEl    = document.getElementById("shortLink");
      const qrBox     = document.getElementById("qrcode");

      themeEl.addEventListener("change", () => {
        applyThemeBackground(themeEl.value || "default");
      });

      document.getElementById("generateBtn").addEventListener("click", () => {
        const msg   = msgEl.value.trim();
        const speed = parseInt(speedEl.value, 10) || 60;
        const color = colorEl.value || "#00ff7f";
        const to    = toEl.value.trim() || "‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô";
        const kind  = kindEl.value || "xmas";
        const from  = fromEl.value.trim() || "‡πÄ‡∏î‡∏¢‡πå";
        const theme = themeEl.value || "default";
        const startDate = startDateEl.value || "";

        if (!msg) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞");
          msgEl.focus();
          return;
        }

        const nowIso = new Date().toISOString();

        const payload = {
          m: msg,
          s: speed,
          c: color.replace("#",""),
          t: to,
          k: kind,
          from: from,
          theme: theme,
          d0: startDate,
          created: nowIso
        };
        const json = JSON.stringify(payload);
        const encoded = LZString.compressToEncodedURIComponent(json);

        const shortUrl = MESSAGE_PAGE_URL + "?d=" + encoded;

        const kindTextMap = {
          xmas: "‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™",
          newyear: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà (TH/EN)",
          songkran: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå",
          birthday: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î"
        };

        const themeTextMap = {
          default: "‡∏õ‡∏Å‡∏ï‡∏¥",
          love: "‡∏£‡∏±‡∏Å",
          sad: "‡πÄ‡∏®‡∏£‡πâ‡∏≤",
          fun: "‡∏™‡∏ô‡∏∏‡∏Å",
          thanks: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì"
        };

        let summary =
          "‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤:\n" +
          `‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${msg}\n` +
          `‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å: ${from}\n` +
          `‚Ä¢ ‡∏ò‡∏µ‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ${themeTextMap[theme] || theme}\n` +
          `‚Ä¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå: ${speed} ms/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£\n` +
          `‚Ä¢ ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£: ${color}\n` +
          `‚Ä¢ ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: ${to}\n` +
          `‚Ä¢ ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå: ${kindTextMap[kind] || kind}\n` +
          `‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå: ${new Date(nowIso).toLocaleString("th-TH")}`;

        if (startDate) {
          summary += `\n‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô: ${startDate} (‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå)`;
        }

        summaryEl.textContent = summary;

        linkEl.textContent = shortUrl;
        linkEl.href = shortUrl;

        qrBox.innerHTML = "";
        new QRCode(qrBox, {
          text: shortUrl,
          width: 260,
          height: 260,
          correctLevel: QRCode.CorrectLevel.L
        });

        resultBox.style.display = "block";
      });
    }

    function setupViewerMode() {
      let m, s, cHex, t, k, startDateStr, createdIso, from, theme;

      if (params.has("d")) {
        const encoded = params.get("d") || "";
        const json = LZString.decompressFromEncodedURIComponent(encoded) || "{}";
        let data;
        try {
          data = JSON.parse(json);
        } catch {
          data = {};
        }
        m    = data.m || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡∏ô‡∏∞ :)";
        s    = parseInt(data.s || 60, 10);
        cHex = data.c || "00ff7f";
        t    = data.t || "‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô";
        k    = data.k || "xmas";
        from = data.from || "‡πÄ‡∏î‡∏¢‡πå";
        theme = data.theme || "default";
        startDateStr = data.d0 || "";
        createdIso   = data.created || "";
      } else {
        m = params.get("m") || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡∏ô‡∏∞ :)";
        s = parseInt(params.get("s") || "60", 10);
        cHex = params.get("c") || "00ff7f";
        t = params.get("t") || "‡πÉ‡∏Ñ‡∏£‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô";
        k = params.get("k") || "xmas";
        from = "‡πÄ‡∏î‡∏¢‡πå";
        theme = "default";
        startDateStr = "";
        createdIso = "";
      }

      applyThemeBackground(theme);

      const msgBox = document.getElementById("msgBox");
      const toLine = document.getElementById("toLine");
      const meta   = document.getElementById("meta");
      const status = document.getElementById("status");
      const homeLink = document.getElementById("homeLink");
      const symbolTitle = document.getElementById("symbolTitle");
      const viewerTitle = document.getElementById("viewerTitle");
      const messageBoxEl = document.getElementById("messageBox");

      const color = "#" + cHex;

      const themeNameMap = {
        default: "",
        love: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å",
        sad: "‡πÄ‡∏®‡∏£‡πâ‡∏≤",
        fun: "‡∏™‡∏ô‡∏∏‡∏Å",
        thanks: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì"
      };

      let title = '‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡∏≤‡∏Å : "' + from + '"';
      if (themeNameMap[theme]) {
        title += " ‚Ä¢ ‡∏ò‡∏µ‡∏°: " + themeNameMap[theme];
      }
      viewerTitle.textContent = title;

      messageBoxEl.style.boxShadow = "none";
      messageBoxEl.style.borderColor = "#1f2937";
      messageBoxEl.style.background = "#020617";

      if (theme === "love") {
        messageBoxEl.style.borderColor = "#fb7185";
        messageBoxEl.style.boxShadow = "0 0 24px rgba(248,113,113,0.35)";
        messageBoxEl.style.background =
          "radial-gradient(circle at top, rgba(248,113,113,0.18), #020617 60%)";
      } else if (theme === "sad") {
        messageBoxEl.style.borderColor = "#38bdf8";
        messageBoxEl.style.boxShadow = "0 0 24px rgba(56,189,248,0.30)";
        messageBoxEl.style.background =
          "radial-gradient(circle at top, rgba(37,99,235,0.18), #020617 60%)";
      } else if (theme === "fun") {
        messageBoxEl.style.borderColor = "#eab308";
        messageBoxEl.style.boxShadow = "0 0 24px rgba(234,179,8,0.30)";
        messageBoxEl.style.background =
          "radial-gradient(circle at top, rgba(234,179,8,0.20), #020617 60%)";
      } else if (theme === "thanks") {
        messageBoxEl.style.borderColor = "#22c55e";
        messageBoxEl.style.boxShadow = "0 0 24px rgba(34,197,94,0.30)";
        messageBoxEl.style.background =
          "radial-gradient(circle at top, rgba(34,197,94,0.20), #020617 60%)";
      }

      symbolTitle.textContent = "";

      toLine.textContent = "‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: " + t;
      toLine.style.color = color;
      msgBox.style.color = color;

      const metaLines = [];

      if (createdIso) {
        const created = new Date(createdIso);
        metaLines.push("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: " + created.toLocaleString("th-TH"));
      }

      if (startDateStr) {
        const start = new Date(startDateStr);
        const today = new Date();
        const dayMs = 24 * 60 * 60 * 1000;
        const diffDays = Math.floor((today - start) / dayMs);
        const startLabel = start.toLocaleDateString("th-TH");

        let ageYears = today.getFullYear() - start.getFullYear();
        const hasHadBirthdayThisYear =
          (today.getMonth() > start.getMonth()) ||
          (today.getMonth() === start.getMonth() && today.getDate() >= start.getDate());
        if (!hasHadBirthdayThisYear) ageYears -= 1;
        if (ageYears < 0) ageYears = 0;

        let line = "‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å " + startLabel + " ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: " + diffDays + " ‡∏ß‡∏±‡∏ô";
        line += " ‚Ä¢ ‡∏≠‡∏≤‡∏¢‡∏∏: " + ageYears + " ‡∏õ‡∏µ";
        metaLines.push(line);
      }

      if (metaLines.length > 0) {
        meta.textContent = metaLines.join("\n");
        meta.style.display = "block";
      } else {
        meta.textContent = "";
        meta.style.display = "none";
      }

      homeLink.href = HOME_URL;

      typeWriter(m, isNaN(s) ? 60 : s, msgBox, status);
      startSymbolDisplay(k, color);
    }

    async function typeWriter(text, speed, msgBox, statusEl) {
      msgBox.textContent = "";
      for (let ch of text) {
        msgBox.textContent += ch;
        await new Promise(res => setTimeout(res, speed));
      }
      statusEl.textContent = "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß";
    }

    const treeLines = [
      "        *",
      "       ***",
      "      *****",
      "     *******",
      "    *********",
      "   ***********",
      "  *************",
      "       |||",
      "       |||"
    ];

    const treeColors = [
      "#f97316",
      "#fb7185",
      "#22c55e",
      "#38bdf8",
      "#eab308"
    ];

    function startSymbolDisplay(kind, mainColor) {
      const area = document.getElementById("symbolArea");
      if (!area) return;

      const color = mainColor || "#22c55e";

      if (kind === "xmas") {
        function renderTree() {
          let html = "";
          for (let i = 0; i < treeLines.length; i++) {
            const line = treeLines[i];
            for (let ch of line) {
              if (ch === "*") {
                const c = treeColors[Math.floor(Math.random() * treeColors.length)];
                html += `<span style="color:${c}">*</span>`;
              } else if (ch === "|") {
                html += `<span style="color:#9ca3af">|</span>`;
              } else if (ch === " ") {
                html += "&nbsp;";
              } else {
                html += `<span style="color:${color}">${ch}</span>`;
              }
            }
            html += "<br>";
          }
          area.innerHTML = html;
        }
        renderTree();
        setInterval(renderTree, 180);
      } else if (kind === "newyear") {
        let tick = 0;
        function renderNY() {
          const c1 = tick % 2 === 0 ? color : "#38bdf8";
          const c2 = tick % 2 === 0 ? "#eab308" : "#f97316";
          area.innerHTML =
            `<div style="font-size:0.85rem;color:${c1};">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà</div>` +
            `<div style="font-size:0.75rem;color:${c2};margin-top:4px;">HAPPY NEW YEAR</div>`;
          tick++;
        }
        renderNY();
        setInterval(renderNY, 500);
      } else if (kind === "songkran") {
        let tick = 0;
        function renderSongkran() {
          const c1 = tick % 2 === 0 ? color : "#38bdf8";
          area.innerHTML =
            `<div style="font-size:0.85rem;color:${c1};">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå</div>` +
            `<div style="font-size:0.75rem;color:#60a5fa;margin-top:4px;">Happy Songkran</div>` +
            `<div style="font-size:1.2rem;margin-top:4px;">üíß üí¶ üíß</div>`;
          tick++;
        }
        renderSongkran();
        setInterval(renderSongkran, 600);
      } else if (kind === "birthday") {
        let tick = 0;
        function renderBD() {
          const c1 = tick % 2 === 0 ? color : "#fb7185";
          area.innerHTML =
            `<div style="font-size:0.85rem;color:${c1};">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</div>` +
            `<div style="font-size:0.75rem;color:#fbbf24;margin-top:4px;">Happy Birthday</div>` +
            `<div style="font-size:1.2rem;margin-top:4px;">üéÇ<span style="color:#f97316;">‚òÖ</span>üéÇ</div>`;
          tick++;
        }
        renderBD();
        setInterval(renderBD, 600);
      } else {
        area.textContent = "‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå";
      }
    }
  </script>
</body>
</html>
